<html>

<head>
    <style>
        body {
            background-color: black;
        }

        .grid-container {
            width: 500px;
            height: 500px;
            margin: 0 auto;
            background-color: black;
            color: #fff;
            /* border: 6px solid white; */
            border-radius: 10px;
            display: grid;
            grid-template: repeat(3, 1fr) / repeat(3, 1fr);
        }

        .i0,
        .i1,
        .i2,
        .i3,
        .i4,
        .i5,
        .i6,
        .i7,
        .i8 {
            /* border: 6px solid white; */
            border-radius: 2px;
            font-family: Helvetica;
            font-weight: bold;
            font-size: 6em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .i0 {
            border-right: 3px solid white;
            border-bottom: 3px solid white;
        }

        .i1 {
            border-right: 4px solid white;
            border-bottom: 4px solid white;
            border-left: 4px solid white;
        }

        .i2 {
            border-left: 4px solid white;
            border-bottom: 4px solid white;
        }

        .i3 {
            border-right: 4px solid white;
            border-bottom: 4px solid white;
            border-top: 4px solid white;
        }

        .i4 {
            border: 4px solid white;
        }

        .i5 {
            border-left: 4px solid white;
            border-bottom: 4px solid white;
            border-top: 4px solid white;
        }

        .i6 {
            border-right: 4px solid white;
            border-top: 4px solid white;
        }

        .i7 {
            border-right: 4px solid white;
            border-top: 4px solid white;
            border-left: 4px solid white;
        }

        .i8 {
            border-left: 4px solid white;
            border-top: 4px solid white;
        }

        .score {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #status {
            font-size: 3em;
            padding-left: 30px;
            padding-right: 30px;
            color: white;
        }

        #player {
            font-size: 3em;
            padding-left: 30px;
            padding-right: 30px;
            color: white;
            cursor: pointer;
        }
    </style>
    <script>
        var count = 0;
        var play;
        var res = 0;
        var type=2;
        var board = Array(3);
        let player="O";
        let opponent = "X";
        for (var i = 0; i < 3; i++) {
            board[i] = Array(3);
        }
        function display() {
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    if (board[i][j]) {
                        document.getElementById((i * 3 + j).toString()).innerHTML = board[i][j];
                    }
                    else {
                        document.getElementById((i * 3 + j).toString()).innerHTML = " ";
                    }

                }
            }
        }
        function changeType() {
            var x = document.getElementById("player").innerHTML;
            var y;
            if (x == "2P"){
                y = "1P";
                type = 1;
            }
            else{
                y = "2P";
                type = 2;
            }
            document.getElementById("player").innerHTML = y;
            reset();
        }
        function Xwins() {
            for (var i = 0; i < 3; i++) {
                if (board[i][0] == board[i][1] && board[i][1] == board[i][2] && board[i][0] == "X") return (i + 1) * 2;
            }
            for (var i = 0; i < 3; i++) {
                if (board[0][i] == board[1][i] && board[1][i] == board[2][i] && board[0][i] == "X") return 2 * i + 1;
            }
            if (board[0][0] == board[1][1] && board[1][1] == board[2][2] && board[0][0] == "X") return 6;
            if (board[0][2] == board[1][1] && board[1][1] == board[2][0] && board[1][1] == "X") return 7;
            return 0;
        }
        function Owins() {
            for (var i = 0; i < 3; i++) {
                if (board[i][0] == board[i][1] && board[i][1] == board[i][2] && board[i][0] == "O") return (i + 1) * 2;
            }
            for (var i = 0; i < 3; i++) {
                if (board[0][i] == board[1][i] && board[1][i] == board[2][i] && board[0][i] == "O") return 2 * i + 1;
            }
            if (board[0][0] == board[1][1] && board[1][1] == board[2][2] && board[0][0] == "O") return 6;
            if (board[0][2] == board[1][1] && board[1][1] == board[2][0] && board[1][1] == "O") return 7;
            return 0;
        }
        function reset() {
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    board[i][j] = " ";
                    document.getElementById((i * 3 + j).toString()).style.color = "white";
                }
            }
            display();
            count = 0;
            play = "X";
            res = 0;
            document.getElementById("status").innerHTML = "Player X's Turn";
        }
        function changeColor(grid, val) {
            console.log(grid);
            if (grid == 0) {
                for (var i = 0; i < 3; i++) {
                    document.getElementById((3 * val + i).toString()).style.color = "green";
                }
            }
            else if (grid == 1) {
                var c = 0;
                for (var i = val; c < 3; i += 3) {
                    document.getElementById(i.toString()).style.color = "green";
                    c++;
                }
            }
            else if (grid == 3) {
                for (var i = 0; i <= 8; i += 4) {
                    document.getElementById(i.toString()).style.color = "green";
                }
            }
            else if (grid == 4) {
                for (var i = 2; i <= 6; i += 2) {
                    document.getElementById(i.toString()).style.color = "green";
                }
            }
        }
        function checkForWin() {
            if (Xwins()) {
                document.getElementById("status").innerHTML = "Player X Won";
                var x = Xwins();
                if (x == 6) {
                    changeColor(3, 0);
                }
                else if (x == 7) {
                    changeColor(4, 1);
                }
                else if (x % 2 == 0) {
                    changeColor(0, (x / 2) - 1);
                }
                else {
                    changeColor(1, (x - 1) / 2);
                }
                res = 1;
            }
            else if (Owins()) {
                document.getElementById("status").innerHTML = "Player O Won";
                var x = Owins();
                if (x == 6) {
                    changeColor(3, 0);
                }
                else if (x == 7) {
                    changeColor(4, 1);
                }
                else if (x % 2 == 0) {
                    changeColor(0, (x / 2) - 1);
                }
                else {
                    changeColor(1, (x - 1) / 2);
                }
                res = 1;
            }
            else if (count == 9) {
                document.getElementById("status").innerHTML = "Draw";
                res = 1;
            }
            return false;
        }
        function change(id) {
            if (res == 1) {
                reset();
            }
            else if(type==2){
                var no = parseInt(id);
                var row = parseInt(no / 3);
                var col = no % 3;
                if (count % 2 == 0) {
                    play = "X";
                    st = "Player O's Turn";
                }
                else {
                    play = "O";
                    st = "Player X's Turn";
                }
                if (board[row][col] != "X" && board[row][col] != "O") {
                    document.getElementById("status").innerHTML = st;
                    count = count + 1;
                    document.getElementById(id).innerHTML = play;
                    board[row][col] = play;
                    checkForWin();
                }
            }
            else if(type==1){
                var no = parseInt(id);
                var row = parseInt(no / 3);
                var col = no % 3;
                if (board[row][col] != "X" && board[row][col] != "O") {
                    count++;
                    document.getElementById(id).innerHTML = "X";
                    board[row][col] = "X";
                    checkForWin();
                    let bestMove = findBestMove(board);
                    board[bestMove.row][bestMove.col] = "O";
                    document.getElementById(bestMove.row*3+bestMove.col).innerHTML = "O";
                    count++;
                    checkForWin();
                }
            }
        }
        // AI mode
        class Move
        {
            constructor()
            {
                let row,col;
            }
        }
        function isMovesLeft(board)
        {
            for(let i = 0; i < 3; i++)
                for(let j = 0; j < 3; j++)
                    if (board[i][j] == " ")
                        return true;
            return false;
        }
        function evaluate(b)
        {
            for(let row = 0; row < 3; row++)
            {
                if (b[row][0] == b[row][1] &&
                    b[row][1] == b[row][2])
                {
                    if (b[row][0] == player)
                        return +10;
                        
                    else if (b[row][0] == opponent)
                        return -10;
                }
            }
        
            for(let col = 0; col < 3; col++)
            {
                if (b[0][col] == b[1][col] &&
                    b[1][col] == b[2][col])
                {
                    if (b[0][col] == player)
                        return +10;
        
                    else if (b[0][col] == opponent)
                        return -10;
                }
            }
            if (b[0][0] == b[1][1] && b[1][1] == b[2][2])
            {
                if (b[0][0] == player)
                    return +10;
                    
                else if (b[0][0] == opponent)
                    return -10;
            }
        
            if (b[0][2] == b[1][1] &&
                b[1][1] == b[2][0])
            {
                if (b[0][2] == player)
                    return +10;
                    
                else if (b[0][2] == opponent)
                    return -10;
            }
            return 0;
        }
        function findBestMove(board)
        {
            let bestVal = -1000;
            let bestMove = new Move();
            bestMove.row = -1;
            bestMove.col = -1;
        
            for(let i = 0; i < 3; i++)
            {
                for(let j = 0; j < 3; j++)
                {
                    
                    if (board[i][j] == ' ')
                    {
                        
                        board[i][j] = player;
        
                        let moveVal = minimax(board, 0, false);

                        board[i][j] = " ";

                        if (moveVal > bestVal)
                        {
                            bestMove.row = i;
                            bestMove.col = j;
                            bestVal = moveVal;
                        }
                    }
                }
            }
        
            return bestMove;
        }
        function minimax(board, depth, isMax)
        {
            let score = evaluate(board);

            if (score == 10)
                return score;

            if (score == -10)
                return score;

            if (isMovesLeft(board) == false)
                return 0;

            if (isMax)
            {
                let best = -1000;
        
                for(let i = 0; i < 3; i++)
                {
                    for(let j = 0; j < 3; j++)
                    {

                        if (board[i][j]==' ')
                        {
                            
                            board[i][j] = player;
        
                            best = Math.max(best, minimax(board,
                                            depth + 1, !isMax));

                            board[i][j] = ' ';
                        }
                    }
                }
                return best;
            }

            else
            {
                let best = 1000;
                for(let i = 0; i < 3; i++)
                {
                    for(let j = 0; j < 3; j++)
                    {

                        if (board[i][j] == ' ')
                        {
                        
                            board[i][j] = opponent;

                            best = Math.min(best, minimax(board,
                                            depth + 1, !isMax));
                            board[i][j] = ' ';
                        }
                    }
                }
                return best;
            }
        }
    </script>
</head>

<body>
    <div class="grid-container">
        <div class="i0" id="0" onclick="change(this.id)"> </div>
        <div class="i1" id="1" onclick="change(this.id)"> </div>
        <div class="i2" id="2" onclick="change(this.id)"> </div>
        <div class="i3" id="3" onclick="change(this.id)"> </div>
        <div class="i4" id="4" onclick="change(this.id)"> </div>
        <div class="i5" id="5" onclick="change(this.id)"> </div>
        <div class="i6" id="6" onclick="change(this.id)"> </div>
        <div class="i7" id="7" onclick="change(this.id)"> </div>
        <div class="i8" id="8" onclick="change(this.id)"> </div>
    </div>
    <br><br>
    <div class="score">
        <div id="status">Player X Turn</div>
        <div id="player" onclick="changeType()">2P</div>
    </div>
</body>

</html>
